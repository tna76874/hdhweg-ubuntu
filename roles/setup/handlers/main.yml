---
- name: update flatpaks
  shell: "flatpak update {{ item.package }} -y"
  with_items: "{{ config_flatpak_list }}"
  when: item.version is not defined

- name: update flatpak versions
  shell: "flatpak update {{ item.package }} --commit={{ item.version }} -y"
  with_items: "{{ config_flatpak_list }}"
  when: item.version is defined

- name: make rtw89 module
  shell: "{{ item }}"
  args:
    chdir: "{{ rtw89_repo_dir }}"
  become: yes
  changed_when: True
  ignore_errors: yes
  loop:
    - "make"
    - "sudo make install"
  notify:
    - disable rtw89
    - enable rtw89

- name: disable rtw89
  modprobe:
    name: rtw89pci
    state: absent
  ignore_errors: yes

- name: enable rtw89
  modprobe:
    name: rtw89pci
    state: present
  ignore_errors: yes

- include: ../../base/handlers/main.yml